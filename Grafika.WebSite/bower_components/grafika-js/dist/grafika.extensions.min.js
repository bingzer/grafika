Grafika.Plugins.push(function(a){var b=function(){function a(a){var b=this;this.grafika=a,this.name="Extensions",this.version="1.0.0",this.imageQuality=100,this.getName=function(){return"["+b.name+" "+b.version+"]"},this.isLogEnabled=function(){return b.grafika.getOptions().debugMode},this.clearFrame=function(){b.grafika.clearFrame(),b.grafika.saveFrame()},this.deleteFrame=function(){var a=b.grafika.animation,c=a.currentFrame;0>c||(b.grafika.frames.splice(c,1),0==b.grafika.frames.length&&b.grafika.frames.push(b.frameRenderer.create()),c>b.grafika.frames.length-1&&(c=b.grafika.frames.length-1),a.currentFrame=c,b.grafika.frame=b.grafika.frames[a.currentFrame],b.grafika.navigateToFrame(a.currentFrame))},this.copyFrameToNext=function(){b.grafika.saveFrame();var a=b.grafika.getAnimation().currentFrame+1,c=JSON.parse(JSON.stringify(b.grafika.getFrame(),b.getJSONReplacer()));c.index=a,c.id=Grafika.randomUid(),b.grafika.frames[a]=b.frameRenderer.create(c),b.grafika.navigateToFrame(a),b.grafika.saveFrame(),Grafika.log(b,"Frame copied to next frame")},this.copyFrameToPrevious=function(){b.grafika.saveFrame();var a=b.grafika.getAnimation().currentFrame-1;if(!(0>a)){var c=JSON.parse(JSON.stringify(b.grafika.getFrame(),b.getJSONReplacer()));c.index=a,c.id=Grafika.randomUid(),b.grafika.frames[a]=b.frameRenderer.create(c),b.grafika.navigateToFrame(a),b.grafika.saveFrame(),Grafika.log(b,"Frame copied to previous frame")}},this.insertFrameAfter=function(){b.grafika.saveFrame();var a=b.grafika.animation.currentFrame,c=b.frameRenderer.create({index:a+1}),d=b.grafika.frame;b.grafika.frames.splice(a,0,c),b.grafika.frames[a]=d,b.grafika.frames[c.index]=c,b.grafika.animation.currentFrame=c.index,b.grafika.frame=b.grafika.frames[c.index],b.grafika.saveFrame(),b.grafika.navigateToFrame(b.grafika.animation.currentFrame),Grafika.log(b,"Frame inserted after current frame")},this.insertFrameBefore=function(){b.grafika.saveFrame();var a=b.grafika.animation.currentFrame;if(!(0>a)){var c=b.frameRenderer.create({index:a});b.grafika.frames.splice(a,0,c),b.grafika.frame=b.grafika.frames[a],b.grafika.saveFrame(),b.grafika.navigateToFrame(b.grafika.animation.currentFrame),Grafika.log(b,"Frame inserted before current frame")}},this.getFrameProperty=function(a){return b.grafika.frame[a]},this.deleteSelectedGraphics=function(){b.grafika.deleteSelectedGraphics(),b.grafika.saveFrame(),Grafika.log(b,"Selected graphics deleted")},this.copySelectedGraphics=function(){b.grafika.copySelectedGraphics(),Grafika.log(b,"Selected graphics copied")},this.pasteSelectedGraphics=function(){b.grafika.pasteSelectedGraphics(),b.grafika.saveFrame(),Grafika.log(b,"Selected graphics pasted")},this.downloadAnimation=function(){b.grafika.saveFrame(),window.open("data:application/json;charset=utf-8,"+JSON.stringify(b.grafika.getAnimation(),b.getJSONReplacer()))},this.downloadFrameAsImage=function(){b.grafika.saveFrame(),b.getCanvasData(function(a,b){a||window.open("data:image/png;base64,"+b.base64)})},this.getCanvasBlob=function(a){var c=void 0,d=void 0,e=b.captureOldOptions(),f=b.grafika.getRenderer("frame");if(f.drawBackground(b.grafika.contextBackground,b.grafika.getFrame(),function(g,h){f.draw(b.grafika.contextBackground,b.grafika.getFrame()),c=g;try{for(var i=atob(b.grafika.contextBackground.canvas.toDataURL("image/png",b.imageQuality).split(",")[1]),j=[],k=0;k<i.length;k++)j.push(i.charCodeAt(k));b.grafika.setOptions(e),d={mime:"image/png",blob:new Blob([new Uint8Array(j)])}}catch(l){c=l}a&&a(c,d)}),!a)var g=setInterval(function(){(Grafika.isDefined(c)||Grafika.isDefined(d))&&clearInterval(g)},100);return d},this.getCanvasData=function(a){var c=void 0,d=void 0,e=b.captureOldOptions(),f=b.grafika.getRenderer("frame");if(f.drawBackground(b.grafika.contextBackground,b.grafika.getFrame(),function(g,h){f.draw(b.grafika.contextBackground,b.grafika.getFrame()),c=g;try{var i=b.grafika.contextBackground.canvas.toDataURL("image/png",b.imageQuality),j=i.substring(i.indexOf("data:")+"data:".length,i.indexOf(";"));b.grafika.setOptions(e),b.grafika.refreshFrame({drawBackground:!0}),d={mime:j,base64:i.substring(i.indexOf(",")+",".length)}}catch(k){c=k}a&&a(c,d)}),!a)var g=setInterval(function(){(Grafika.isDefined(c)||Grafika.isDefined(d))&&clearInterval(g)},100);return d},this.frameRenderer=this.grafika.getRenderer("frame")}return a.prototype.captureOldOptions=function(){this.grafika.saveFrame();var a={useNavigationText:this.grafika.getOptions().useNavigationText,useCarbonCopy:this.grafika.getOptions().useCarbonCopy,drawingMode:this.grafika.getOptions().drawingMode};return this.grafika.setOptions({useNavigationText:!1,useCarbonCopy:!1,drawingMode:"none"}),a},a.prototype.getJSONReplacer=function(){return function(a,b){return"grafika"===a?void 0:b}},a}();return a.exts=new b(a)});
//# sourceMappingURL=grafika.js.map