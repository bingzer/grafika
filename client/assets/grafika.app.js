var GrafikaApp;!function(GrafikaApp){var Routes=function(){function Routes($stateProvider,$urlRouterProvider,$locationProvder,$controller){$stateProvider.state("home",{url:"/",templateUrl:"app/layout/home.html"}).state("login",{url:"/login",templateUrl:"app/account/login.html",controller:"LoginController",controllerAs:"vm",data:{pageTitle:"Login"}}).state("profile",{url:"/profile",templateUrl:"app/account/profile.html",controller:"ProfileController",controllerAs:"vm",data:{pageTitle:"Profile",roles:["user"]}}).state("settings",{url:"/settings",templateUrl:"app/account/settings.html",controller:"SettingsController",controllerAs:"vm",data:{pageTitle:"Settings",roles:["user"]}}).state("my-animations",{url:"/animations/mine",templateUrl:"app/animation/mine.html",controller:"MyAnimationsController",controllerAs:"vm",data:{pageTitle:"My Animation",roles:["user"]}}).state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminController",controllerAs:"vm",data:{pageTitle:"Grafika Administration",roles:["administrator"]}}).state("detail",{url:"/animations/:_id",templateUrl:"app/animation/detail.html",controller:"AnimationDetailController",controllerAs:"vm"}).state("drawing",{url:"/animations/:_id/drawing",templateUrl:"app/animation/drawing.html",controller:"AnimationDrawingController",controllerAs:"vm",data:{roles:["user"]}}).state("user",{url:"/users/:_id",templateUrl:"app/users/user.html",controller:"UserController",controllerAs:"vm"}).state("about",{url:"/about",templateUrl:"app/content/about.html",data:{pageTitle:"About Grafika"}}).state("about.feedback",{url:"/feedback",templateUrl:"app/content/feedback.html",data:{pageTitle:"Feedback"}}).state("help",{url:"/help",templateUrl:"app/content/help.html",data:{pageTitle:"Help"}}).state("privacy",{url:"/privacy",templateUrl:"app/content/privacy.html",data:{pageTitle:"Privacy"}}).state("eula",{url:"/eula",templateUrl:"app/content/eula.html",data:{pageTitle:"EULA"}}),$urlRouterProvider.otherwise("/"),$locationProvder.html5Mode(!0)}return Routes.$inject=["$stateProvider","$urlRouterProvider","$locationProvider"],Routes}();GrafikaApp.Routes=Routes}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){function Theme($mdThemingProvider){$mdThemingProvider.definePalette("teal",{50:"#8affff",100:"#3effff",200:"#06ffff",300:"#00bdbd",400:"#009f9f",500:"#008080",600:"#006161",700:"#004343",800:"#002424",900:"#000606",A100:"#8affff",A200:"#3effff",A400:"#009f9f",A700:"#004343",contrastDefaultColor:"light",contrastDarkColors:"50 100 200 300 A100 A200"}),$mdThemingProvider.theme("default").primaryPalette("teal")}GrafikaApp.Theme=Theme}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){var AppConfig=function(){function AppConfig(){this.appTitle="Grafika",this.appVersion="0.9.19-9",this.appBuildTimestamp="Sun Aug 21 2016 08:02:41 GMT-0400 (Eastern Daylight Time)",this.baseUrl="",this.defaultBaseUrl="https://grafika.herokuapp.com/",this.apiBaseUrl="api/",this.animationBaseUrl="https://s3.amazonaws.com/bingzer/grafika/animations/",this.userBaseUrl="https://s3.amazonaws.com/bingzer/grafika/users/",this.contentBaseUrl="https://github.com/bingzer/grafika/",this.fetchSize=10,this.defaultAnimationWidth=800,this.defaultAnimationHeight=400}return AppConfig}();GrafikaApp.AppConfig=AppConfig}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){"use-strict";var AppCommon=function(){function AppCommon($q,$log,$interval,$timeout,$location,$window,$cookieStore,$mdToast,$mdDialog,$state,$stateParams,$mdPanel,$mdMedia,appConfig,uxService){this.$q=$q,this.$log=$log,this.$interval=$interval,this.$timeout=$timeout,this.$location=$location,this.$window=$window,this.$cookieStore=$cookieStore,this.$mdToast=$mdToast,this.$mdDialog=$mdDialog,this.$state=$state,this.$stateParams=$stateParams,this.$mdPanel=$mdPanel,this.$mdMedia=$mdMedia,this.appConfig=appConfig,this.uxService=uxService}return AppCommon.prototype.elem=function(selector){return angular.element(selector)},AppCommon.prototype.alert=function(msg,title,okText){var alert=this.$mdDialog.alert().parent(angular.element(document.body)).htmlContent(msg).ariaLabel("Dialog").ok(okText||"Ok");return title&&alert.title(title),this.$mdDialog.show(alert)},AppCommon.prototype.confirm=function(msg,title,okText,cancelText){var confirm=this.$mdDialog.confirm().parent(angular.element(document.body)).htmlContent(msg).ariaLabel("Dialog").ok(okText||"Ok").cancel(cancelText||"Cancel");return title&&confirm.title(title),this.$mdDialog.show(confirm)},AppCommon.prototype.toastError=function(error,position,delay){return this.toast(this.formatErrorMessage(error),position,delay)},AppCommon.prototype.toast=function(msg,position,delay){return position||(position="top left"),delay||(delay=3e3),this.$log.log(msg),this.$mdToast.show(this.$mdToast.simple().textContent(msg).position(position).hideDelay(delay))},AppCommon.prototype.showDialog=function(controller,templateUrl,event,controllerAs){controllerAs||(controllerAs="vm");var useFullScreen=this.$mdMedia("sm")||this.$mdMedia("xs");return this.$mdDialog.show({fullscreen:useFullScreen,controller:controller,controllerAs:controllerAs,parent:angular.element(document.body),templateUrl:templateUrl,clickOutsideToClose:!0,targetEvent:event})},AppCommon.prototype.refreshPage=function(){this.$location.path(this.$location.path())},AppCommon.prototype.navigateHome=function(){this.navigate("/")},AppCommon.prototype.navigate=function(path){this.$location.path(path)},AppCommon.prototype.randomUid=function(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)},AppCommon.prototype.formatErrorMessage=function(msg){return msg?msg.errorMessage&&msg.errorMessage.length>0?msg.errorMessage:msg.message&&msg.message.length>0?msg.message:msg.data&&msg.data.length>0?msg.data:"An error has occured":msg},AppCommon.prototype.putStorageItem=function(key,value){return this.$q(function(resolve,reject){return angular.isString(value)||(value=JSON.stringify(value)),this.$window.sessionStorage.setItem(key,value),resolve(key)})},AppCommon.prototype.removeStorageItem=function(prefix){return this.$q(function(resolve,reject){if(prefix){for(var i=this.$window.sessionStorage.length;i--;){var key=this.$window.sessionStorage.key(i);new RegExp(prefix).test(key)&&this.$window.sessionStorage.removeItem(key)}resolve()}else this.$window.sessionStorage.clear(),resolve()})},AppCommon.prototype.getStorageItem=function(key){return this.$q(function(resolve,reject){var item=this.$window.sessionStorage.getItem(key);return item?resolve(JSON.parse(item)):void resolve(null)})},AppCommon.prototype.hasStorageItem=function(key){return null!=this.$window.sessionStorage.getItem(key)},AppCommon.prototype.showLoadingModal=function(){return angular.element("#progress-modal").css("visibility","visible"),this.$q.when(!0)},AppCommon.prototype.hideLoadingModal=function(){var deferred=this.$q.defer();return this.$timeout(function(){angular.element("#progress-modal").css("visibility","hidden"),deferred.resolve()},500),deferred.promise},AppCommon.prototype.setLoadingModal=function(loading){return loading?this.showLoadingModal():this.hideLoadingModal()},AppCommon.prototype.contentDialog=function(templateUrl){return this.$mdDialog.show({templateUrl:templateUrl,parent:angular.element(document.body)})},AppCommon.prototype.getBaseUrl=function(){return"localhost"!==this.$location.host()?this.$location.protocol()+"://"+this.$location.host()+(80!=this.$location.port()?":"+this.$location.port():"")+"/":this.appConfig.defaultBaseUrl},AppCommon.$inject=["$q","$log","$interval","$timeout","$location","$window","$cookieStore","$mdToast","$mdDialog","$state","$stateParams","$mdPanel","$mdMedia","appConfig"],AppCommon}();GrafikaApp.AppCommon=AppCommon}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){function AuthInterceptor($window,$location){return{request:function(config){return config.headers=config.headers||{},!config.cors&&$window.sessionStorage.getItem("token")&&(config.headers.Authorization="Bearer "+$window.sessionStorage.getItem("token")),config},response:function(response){return 401!=response.status&&400!=response.status||$location.url("/"),response}}}function HttpInterceptor($httpProvider){$httpProvider.interceptors.push("authInterceptor"),$httpProvider.defaults.headers.get||($httpProvider.defaults.headers.get={}),$httpProvider.defaults.headers.get["If-Modified-Since"]="Mon, 26 Jul 1997 05:00:00 GMT",$httpProvider.defaults.headers.get["Cache-Control"]="no-cache",$httpProvider.defaults.headers.get.Pragma="no-cache"}GrafikaApp.AuthInterceptor=AuthInterceptor,GrafikaApp.HttpInterceptor=HttpInterceptor}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var Base=function(){function Base(appCommon){this.appCommon=appCommon}return Base.$inject=["appCommon"],Base}();GrafikaApp.Base=Base;var BaseService=function(_super){function BaseService(appCommon){_super.call(this,appCommon)}return __extends(BaseService,_super),BaseService}(Base);GrafikaApp.BaseService=BaseService;var BaseController=function(_super){function BaseController(appCommon){_super.call(this,appCommon)}return __extends(BaseController,_super),BaseController}(Base);GrafikaApp.BaseController=BaseController;var AuthController=function(_super){function AuthController(appCommon,authService){_super.call(this,appCommon),this.authService=authService}return __extends(AuthController,_super),AuthController.prototype.isAuthenticated=function(){return this.authService.isAuthenticated()},AuthController.prototype.isAuthorized=function(roles){return this.authService.isAuthorized(roles)},AuthController.prototype.getUser=function(){return this.authService.getUser()},AuthController.$inject=["appCommon","authService"],AuthController}(BaseController);GrafikaApp.AuthController=AuthController;var DialogController=function(_super){function DialogController(appCommon){_super.call(this,appCommon)}return __extends(DialogController,_super),DialogController.prototype.close=function(response){return this.appCommon.$mdDialog.hide(response)},DialogController.prototype.cancel=function(){this.appCommon.$mdDialog.cancel()},DialogController}(BaseController);GrafikaApp.DialogController=DialogController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var AppController=function(_super){function AppController(appCommon,apiService,authService,uxService,$rootScope){var _this=this;_super.call(this,appCommon,authService),this.apiService=apiService,this.uxService=uxService,this.version="",this.buildTimestamp="",this.feedback=new GrafikaApp.Feedback,this.feedbackCategories=["Just saying Hi!","Bug","Features","Other"],this.version=appCommon.appConfig.appVersion,this.buildTimestamp=appCommon.appConfig.appBuildTimestamp,this.appCommon.appConfig.baseUrl=this.appCommon.getBaseUrl(),$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if(toState.data&&toState.data.roles){var user=authService.getUser();user&&user.hasRoles(toState.data.roles)||_this.appCommon.navigateHome()}_this.uxService.pageTitle=_this.appCommon.appConfig.appTitle,toState.data&&toState.data.pageTitle&&(_this.uxService.pageTitle=toState.data.pageTitle)})}return __extends(AppController,_super),AppController.prototype.sendFeedback=function(){var _this=this;this.apiService.post("content/feedback",this.feedback).then(function(res){return _this.appCommon.toast("Feedback is submitted!"),_this.appCommon.$q.when(!0)})["finally"](function(){return _this.feedback=new GrafikaApp.Feedback})},AppController.$inject=["appCommon","apiService","authService","uxService","$rootScope"],AppController}(GrafikaApp.AuthController);GrafikaApp.AppController=AppController}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){var User=function(){function User(payload){payload&&(this._id=payload._id,this.email=payload.email,this.username=payload.username,this.firstName=payload.given_name||payload.firstName,this.lastName=payload.family_name||payload.lastName,this.dateCreated=payload.dateCreated,this.dateModified=payload.dateModified,this.active=payload.active,this.roles=payload.roles,this.prefs=payload.prefs)}return User.prototype.getDisplayName=function(){return this.firstName&&this.lastName?this.firstName+" "+this.lastName:this.email},User.prototype.hasRoles=function(names){var roles=[];angular.isString(names)?roles.push(names):roles=names;for(var anyRole=!1,i=0;i<this.roles.length;i++){for(var j=0;j<roles.length&&(this.roles[i]==roles[j]&&(anyRole=!0),!anyRole);j++);if(anyRole)break}return anyRole},User}();GrafikaApp.User=User}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var Paging=function(){function Paging(paging){this.skip=0,this.limit=10,this.sort="views",paging&&(this.isPublic=paging.isPublic,this.skip=paging.skip,this.limit=paging.limit,this.userId=paging.userId,this.category=paging.category,this.sort=paging.sort,this.query=paging.query,this.type=paging.type)}return Paging.prototype.toQueryString=function(){var query="?uid="+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4);return this.userId&&(query+="&userId="+this.userId),"undefined"!=typeof this.isPublic&&(query+=this.isPublic?"&isPublic=true":"&isPublic=false"),this.category&&(query+="&category="+this.category),this.sort&&(query+="&sort="+this.sort),this.limit&&(query+="&limit="+this.limit),this.skip&&(query+="&skip="+this.skip),this.type&&(query+="&type="+this.type),this.query&&(query+=this.createSearchTerm(this.query)),query},Paging.prototype.next=function(){return this.skip+=this.limit,this.newInstance(this)},Paging.prototype.previous=function(){return this.skip-this.limit<=0?this.skip=0:this.skip-=this.limit,this.newInstance(this)},Paging.prototype.createSearchTerm=function(query){return"&name__regex=/"+this.query+"/g"},Paging.prototype.newInstance=function(paging){return new Paging(this)},Paging}();GrafikaApp.Paging=Paging;var QueryablePaging=function(_super){function QueryablePaging(){_super.apply(this,arguments)}return __extends(QueryablePaging,_super),QueryablePaging.prototype.createSearchTerm=function(query){return"&term="+query},QueryablePaging.prototype.newInstance=function(paging){return new QueryablePaging(this)},QueryablePaging}(Paging);GrafikaApp.QueryablePaging=QueryablePaging}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){var DisqusConfig=function(){function DisqusConfig(appCommon,uniqueId){this.disqus_identifier=uniqueId,this.disqus_api_key="reBkv3Z517WqqbOMhaPOWx710h0JqXRf9X71HMsDTkEfmdvoRYGfxZSJXlQrgzgj",this.disqus_shortname="grafika-app",this.disqus_title="grafika"}return DisqusConfig}();GrafikaApp.DisqusConfig=DisqusConfig}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){var Feedback=function(){function Feedback(){}return Feedback.categories=["Just saying Hi!","Bug","Features","Other"],Feedback}();GrafikaApp.Feedback=Feedback}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){var Animation=function(){function Animation(){}return Animation}();GrafikaApp.Animation=Animation}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){var ActiveLinkDirective=function(){function ActiveLinkDirective($location){var _this=this;this.$location=$location,this.restrict="A",this.link=function(scope,element,attrs,ctr){var clazz=attrs.activeLink,path=attrs.href;path=path.substring(1),scope.location=_this.$location,scope.$watch("location.path()",function(newPath){for(;newPath.length>0&&"/"==newPath.substring(0,1);)newPath=newPath.substring(1);path==newPath?element.parent().addClass(clazz):element.parent().removeClass(clazz)})}}return ActiveLinkDirective.factory=function(){var directive=function($location){return new ActiveLinkDirective($location)};return directive.$inject=["$location"],directive},ActiveLinkDirective}();GrafikaApp.ActiveLinkDirective=ActiveLinkDirective}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){function ImageUploaderController(scope,appCommon,uploadOptions){function initialize(){appCommon.$log.log("Checking canvas",null,"image-uploader"),0!=$("#image-canvas").length&&($("#image-canvas").attr("width",uploadOptions.actualWidth).attr("height",uploadOptions.actualHeight).css("width",uploadOptions.previewWidth).css("height",uploadOptions.previewHeight),appCommon.$interval.cancel(checkCanvas),checkCanvas=void 0,vm.canvasReady=!0)}function getCanvasBlob(){for(var canvas=$("#image-canvas")[0],binary=atob(canvas.toDataURL("image/png",100).split(",")[1]),array=[],i=0;i<binary.length;i++)array.push(binary.charCodeAt(i));return new Blob([new Uint8Array(array)],{type:"image/png"})}var vm=this;vm.message="",vm.preview=function(evt){vm.uploading=!0;var fileReader=new FileReader,file=$("#image-file")[0].files[0];fileReader.onload=function(){if(file){vm.message="Resizing...";var canvas=$("#image-canvas")[0],context=canvas.getContext("2d"),canvasWidth=$("#image-canvas").width(),canvasHeight=$("#image-canvas").height(),img=new Image;img.onload=function(){context.drawImage(img,0,0,canvasWidth,canvasHeight);var data={name:file.name,size:file.size,mime:file.type,getBlob:getCanvasBlob};vm.upload(data)},img.src||(img.src=fileReader.result)}},fileReader.readAsDataURL(file)},vm.upload=function(imageData){return vm.message="Uploading...",vm.uploading=!1,uploadOptions.onUpload({$imageData:imageData}).then(function(){return vm.message="Successfully uploaded"})["catch"](function(err){return vm.message="Unable to upload. "+appCommon.formatErrorMessage(err)})["finally"](function(){return vm.uploading=!1})},vm.close=function(){uploadOptions.onClosed&&uploadOptions.onClosed(),appCommon.$mdDialog.hide()};var checkCanvas=appCommon.$interval(initialize,1e3)}var ImageUploadOptions=function(){function ImageUploadOptions(){}return ImageUploadOptions}();GrafikaApp.ImageUploadOptions=ImageUploadOptions;var ImageUploaderDirective=function(){function ImageUploaderDirective(appCommon){var _this=this;this.appCommon=appCommon,this.restrict="A",this.scope={previewWidth:"=",previewHeight:"=",actualWidth:"=",actualHeight:"=",onUpload:"&",onClosed:"&"},this.link=function(scope,elem,attrs,ctr){elem.bind("click",function(evt){var useFullScreen=_this.appCommon.$mdMedia("sm")||_this.appCommon.$mdMedia("xs");_this.appCommon.$mdDialog.show({fullscreen:useFullScreen,controller:ImageUploaderController,controllerAs:"vm",parent:angular.element(document.body),templateUrl:"app/directives/image-uploader.html",locals:{uploadOptions:scope}})})}}return ImageUploaderDirective.factory=function(){var directive=function(appCommon){return new ImageUploaderDirective(appCommon)};return directive.$inject=["appCommon"],directive},ImageUploaderDirective}();GrafikaApp.ImageUploaderDirective=ImageUploaderDirective}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){var NoResultDirective=function(){function NoResultDirective(){this.restrict="AE",this.template='<div layout-fill layout="column" layout-align="center center" style="margin-top: 32px">\n                        <img src="/content/images/sad_lightgray_128.png">\n                        <div class="md-subtitle" style="color: #d3d3d3; margin-top: 16px">No results</div>\n                    </div>'}return NoResultDirective.factory=function(){var directive=function(){return new NoResultDirective};return directive},NoResultDirective}();GrafikaApp.NoResultDirective=NoResultDirective}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){var FetchMoreDirective=function(){function FetchMoreDirective(){this.restrict="AE",this.template='<div layout="row" layout-align="center center" layout-margin flex>\n                        <gf-spinner ng-show="vm.busy"></gf-spinner>\n                        <md-button class="md-button md-icon-button" ng-click="vm.list()" ng-disabled="vm.fetching" ng-show="vm.canLoadMore">\n                            <md-icon md-font-library="material designs">expand_more</md-icon>\n                            <md-tooltip>Load more...</md-tooltip>\n                        </md-button>\n                    </div>'}return FetchMoreDirective.factory=function(){var directive=function(){return new FetchMoreDirective};return directive},FetchMoreDirective}();GrafikaApp.FetchMoreDirective=FetchMoreDirective}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){var RatingStarsDirective=function(){function RatingStarsDirective(appCommon,animationService){var _this=this;this.appCommon=appCommon,this.animationService=animationService,this.msgHtml="",this.starHtml='<div class="star" style="display: inline">\n                        <a href="javascript:void(0)" class="full hidden" class="md-icon-button"><i class="material-icons">star</i></a>\n                        <a href="javascript:void(0)" class="half hidden" class="md-icon-button"><i class="material-icons">star_half</i></a>\n                        <a href="javascript:void(0)" class="empty hidden" class="md-icon-button"><i class="material-icons">star_border</i></a>\n                    </div>',this.restrict="AE",this.link=function(scope,elem,attrs,ctr){function check(name,value){value&&("animationId"===name&&(animationId=value),"rating"===name&&(rating=value),animationId&&rating&&evaluate())}function evaluate(){var counter=0;for(rating||(rating=2.5),elem.html("");counter>=0&&counter<5;){var html=jQuery(that.starHtml);rating>=1?html.find(".full").removeClass("hidden").attr("title",counter+1).data("value",counter+1).bind("click",function(e){return rate(jQuery(e.target).parent())}):rating>=.5&&rating<=1?html.find(".half").removeClass("hidden").attr("title",counter+1).data("value",counter+1).bind("click",function(e){return rate(jQuery(e.target).parent())}):html.find(".empty").removeClass("hidden").attr("title",counter+1).data("value",counter+1).bind("click",function(e){return rate(jQuery(e.target).parent())}),elem.append(html),rating>0&&rating--,counter++}}function rate(elem){that.animationService.rate(animationId,elem.data("value")).then(function(res){rating=res.data,evaluate(),that.appCommon.toast("Rating submitted")})}attrs.$observe("animationId",function(val){return check("animationId",val)}),attrs.$observe("rating",function(val){return check("rating",val)});var animationId=scope.animationId,rating=parseInt(scope.rating),that=_this}}return RatingStarsDirective.factory=function(){var directive=function(appCommon,animationService){return new RatingStarsDirective(appCommon,animationService)};return directive.$inject=["appCommon","animationService"],directive},RatingStarsDirective}();GrafikaApp.RatingStarsDirective=RatingStarsDirective}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){var IncludeMarkdownDirective=function(){function IncludeMarkdownDirective(){this.restrict="AE",this.scope={markdownUrl:"="},this.bindToController=!0,this.controllerAs="vm",this.controller=IncludeMarkdownController}return IncludeMarkdownDirective.factory=function(){var directive=function(){return new IncludeMarkdownDirective};return directive},IncludeMarkdownDirective}();GrafikaApp.IncludeMarkdownDirective=IncludeMarkdownDirective;var IncludeMarkdownController=function(){function IncludeMarkdownController(appCommon,$element,$http){var _this=this;this.appCommon=appCommon,this.$element=$element,this.$http=$http,this.$element.html('<p style="width: 100%">Loading markdown...</p>'),$http.get(this.markdownUrl).then(function(res){return _this.render(res)})["catch"](function(res){return _this.renderError()})}return IncludeMarkdownController.prototype.render=function(res){var _this=this,defer=this.appCommon.$q.defer();return this.appCommon.$timeout(function(){if(res){var html=markdown.toHTML(res.data);_this.$element.html("<div>"+html+"</div>"),defer.resolve()}else defer.reject()},500),defer.promise},IncludeMarkdownController.prototype.renderError=function(){var _this=this,defer=this.appCommon.$q.defer();return this.appCommon.$timeout(function(){var html='<p class="md-warn">Unable to retrieve data</p>';_this.$element.html("<div>"+html+"</div>"),defer.resolve()},500),defer.promise},IncludeMarkdownController.$inject=["appCommon","$element","$http"],IncludeMarkdownController}()}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){var GfSpinner=function(){function GfSpinner(){this.restrict="AE",this.template='<div class="gf-spinner">\n                        <div class="rect1"></div>\n                        <div class="rect2"></div>\n                        <div class="rect3"></div>\n                        <div class="rect4"></div>\n                        <div class="rect5"></div>\n                    </div>'}return GfSpinner.factory=function(){var directive=function(){return new GfSpinner};return directive},GfSpinner}();GrafikaApp.GfSpinner=GfSpinner}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var UxService=function(_super){function UxService(appCommon){_super.call(this,appCommon),this.pageTitle=appCommon.appConfig.appTitle}return __extends(UxService,_super),UxService.$inject=["appCommon"],UxService}(GrafikaApp.BaseService);GrafikaApp.UxService=UxService}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var ApiService=function(_super){function ApiService(appCommon,$http){_super.call(this,appCommon),this.$http=$http}return __extends(ApiService,_super),ApiService.prototype.get=function(path){var _this=this;return this.$http.get(this.url(path)).error(function(data,status,headers,config){return _this.log(data,status,headers,config)})},ApiService.prototype.post=function(path,data){var _this=this;return this.$http.post(this.url(path),data).error(function(data,status,headers,config){return _this.log(data,status,headers,config)})},ApiService.prototype.put=function(path,data){var _this=this;return this.$http.put(this.url(path),data).error(function(data,status,headers,config){return _this.log(data,status,headers,config)})},ApiService.prototype["delete"]=function(path){var _this=this;return this.$http["delete"](this.url(path)).error(function(data,status,headers,config){return _this.log(data,status,headers,config)})},ApiService.prototype.url=function(path){return this.appCommon.appConfig.apiBaseUrl+path},ApiService.prototype.log=function(data,status,headers,config){var deferred=this.appCommon.$q.defer();return 401!=status&&403!=status&&0!=status||(this.appCommon.hideLoadingModal(),this.appCommon.navigate("/")),this.appCommon.$log.error(config.method+": "+config.url+" ("+status+")"),deferred.resolve(),deferred.promise},ApiService.$inject=["appCommon","$http"],ApiService}(GrafikaApp.BaseService);GrafikaApp.ApiService=ApiService}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var AuthService=function(_super){function AuthService(appCommon,$rootScope,apiService,jwtHelper){_super.call(this,appCommon),this.$rootScope=$rootScope,this.apiService=apiService,this.jwtHelper=jwtHelper}return __extends(AuthService,_super),AuthService.prototype.register=function(user){return this.apiService.post("accounts/register",user)},AuthService.prototype.login=function(user,provider){var _this=this;return provider?(window.location.href=this.appCommon.appConfig.apiBaseUrl+"accounts/"+provider.toLowerCase(),this.appCommon.$q.when(!0)):this.apiService.post("accounts",user).success(function(){return _this.authenticate(!0)})},AuthService.prototype.setAccessToken=function(token){return token?(this.user=null,this.appCommon.$window.sessionStorage.setItem("token",token),this.user=this.getUser(),this.appCommon.$q.when(!0)):this.appCommon.$q.when(!1)},AuthService.prototype.getAccessToken=function(){return this.appCommon.$window.sessionStorage.getItem("token")},AuthService.prototype.logout=function(){var _this=this;return this.apiService.post("accounts/logout")["finally"](function(){return _this.clearToken(),_this.clearSession(),_this.appCommon.navigateHome(),_this.appCommon.$q.when(!0)})},AuthService.prototype.clearToken=function(){this.appCommon.$window.sessionStorage.removeItem("token")},AuthService.prototype.clearSession=function(){this.appCommon.$cookieStore.remove("grafika.session")},AuthService.prototype.authenticate=function(skipLogout){var _this=this,deferred=this.appCommon.$q.defer();return this.apiService.post("accounts/authenticate").success(function(res){_this.setAccessToken(res.token),deferred.resolve()}).error(function(){deferred.reject(),skipLogout||_this.logout()}),deferred.promise},AuthService.prototype.isAuthenticated=function(){return null!=this.appCommon.$window.sessionStorage.getItem("token")},AuthService.prototype.isAuthorized=function(roles){if(!this.isAuthenticated())return!1;var explicit=angular.isDefined(roles),user=this.getUser();return explicit?user.hasRoles(roles):user.hasRoles("user")},AuthService.prototype.changePassword=function(pwd){return this.apiService.post("accounts/pwd",pwd)},AuthService.prototype.resetPassword=function(user){return this.apiService.post("accounts/pwd/reset",user)},AuthService.prototype.getDisqusToken=function(){return this.apiService.get("accounts/disqus")},AuthService.prototype.getUser=function(){if(!this.appCommon.$window.sessionStorage.getItem("token"))return this.user=null,this.user;if(this.user)return this.user;var payload=this.jwtHelper.decodeToken(this.appCommon.$window.sessionStorage.getItem("token")),user=new GrafikaApp.User(payload);return user},AuthService.$inject=["appCommon","$rootScope","apiService","jwtHelper"],AuthService}(GrafikaApp.BaseService);GrafikaApp.AuthService=AuthService}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var AnimationService=function(_super){function AnimationService(appCommon,authService,apiService,resourceService){_super.call(this,appCommon),this.authService=authService,this.apiService=apiService,this.resourceService=resourceService}return __extends(AnimationService,_super),AnimationService.prototype.create=function(anim){return this.apiService.post("animations",anim)},AnimationService.prototype.list=function(paging){var _this=this;return paging||(paging=new GrafikaApp.Paging),this.apiService.get("animations"+paging.toQueryString()).then(function(res){return _this.injectThumbnailUrl(res)})},AnimationService.prototype.get=function(_id){var _this=this;return this.apiService.get("animations/"+_id).then(function(res){return _this.injectThumbnailUrl(res)})},AnimationService.prototype["delete"]=function(_id){return this.apiService["delete"]("animations/"+_id)},AnimationService.prototype.update=function(anim){var _this=this;return this.apiService.put("animations/"+anim._id,anim).then(function(res){return _this.injectThumbnailUrl(res)})},AnimationService.prototype.incrementViewCount=function(anim){
return this.apiService.post("animations/"+anim._id+"/view")},AnimationService.prototype.rate=function(animationId,rating){return this.apiService.post("animations/"+animationId+"/rating/"+rating)},AnimationService.prototype.getDownloadLink=function(anim){return this.appCommon.getBaseUrl()+"animations/"+anim._id+"/download?token="+this.authService.getAccessToken()},AnimationService.prototype.injectThumbnailUrl=function(res){var _this=this;if(angular.isArray(res.data)){var anims=res.data;anims.forEach(function(anim){return anim.thumbnailUrl=_this.resourceService.getThumbnailUrl(anim)})}else{var anim=res.data;anim.thumbnailUrl=this.resourceService.getThumbnailUrl(anim)}return this.appCommon.$q.when(res)},AnimationService.$inject=["appCommon","authService","apiService","resourceService"],AnimationService}(GrafikaApp.BaseService);GrafikaApp.AnimationService=AnimationService}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var FrameService=function(_super){function FrameService(appCommon,authService,apiService){_super.call(this,appCommon),this.authService=authService,this.apiService=apiService}return __extends(FrameService,_super),FrameService.prototype.get=function(animation){return this.apiService.get("animations/"+animation._id+"/frames")},FrameService.prototype.update=function(animation,data){return this.apiService.post("animations/"+animation._id+"/frames",data)},FrameService.$inject=["appCommon","authService","apiService"],FrameService}(GrafikaApp.BaseService);GrafikaApp.FrameService=FrameService}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var ResourceService=function(_super){function ResourceService(appCommon,authService,apiService){_super.call(this,appCommon),this.authService=authService,this.apiService=apiService}return __extends(ResourceService,_super),ResourceService.prototype.list=function(anim){return this.apiService.get("animations/"+anim._id+"/resources/")},ResourceService.prototype.get=function(anim,resourceId){return this.apiService.get("animations/"+anim._id+"/resources/"+resourceId)},ResourceService.prototype.del=function(anim,resourceId){return this.apiService["delete"]("animations/"+anim._id+"/resources/"+resourceId)},ResourceService.prototype.create=function(anim,resource){return this.apiService.post("animations/"+anim._id+"/resources/",resource)},ResourceService.prototype.upload=function(data,blob){if(!data.mime||!data.signedUrl)throw new Error("Expecting data.mime && data.signedUrl");var req={method:"PUT",url:data.signedUrl,cors:!0,headers:{Authorization:void 0,"Content-Type":data.mime,"x-amz-acl":"public-read"},data:blob};return this.apiService.$http(req)},ResourceService.prototype.getResourceUrl=function(anim,resource){var resourceId=resource;return resource instanceof Grafika.IResource&&(resourceId=resource._id),this.appCommon.appConfig.animationBaseUrl+anim._id+"/"+resourceId},ResourceService.prototype.getThumbnailUrl=function(anim){return this.appCommon.appConfig.apiBaseUrl+"animations/"+anim._id+"/thumbnail"},ResourceService.prototype.saveThumbnail=function(anim){return this.apiService.post("animations/"+anim._id+"/thumbnail")},ResourceService.$inject=["appCommon","authService","apiService"],ResourceService}(GrafikaApp.BaseService);GrafikaApp.ResourceService=ResourceService}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var UserService=function(_super){function UserService(appCommon,authService,apiService){_super.call(this,appCommon),this.authService=authService,this.apiService=apiService}return __extends(UserService,_super),UserService.prototype.list=function(paging){return this.apiService.get("users")},UserService.prototype.get=function(_id){return this.apiService.get("users/"+_id)},UserService.prototype.update=function(user){return this.apiService.put("users/"+user._id,user)},UserService.prototype.checkAvailability=function(email,username){return this.apiService.post("accounts/username-check",{email:email,username:username})},UserService.$inject=["appCommon","authService","apiService"],UserService}(GrafikaApp.BaseService);GrafikaApp.UserService=UserService}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var AdminService=function(_super){function AdminService(appCommon,authService,apiService){_super.call(this,appCommon),this.authService=authService,this.apiService=apiService}return __extends(AdminService,_super),AdminService.prototype.getServerInfo=function(){return this.apiService.get("admin")},AdminService.prototype.listAnimations=function(paging){return this.apiService.get("admin/animations"+paging.toQueryString())},AdminService.prototype.listUsers=function(paging){return this.apiService.get("admin/users"+paging.toQueryString())},AdminService.prototype.sendVerificationEmail=function(user){return this.apiService.post("admin/users/"+user._id+"/reverify")},AdminService.prototype.sendResetPasswordEmail=function(user){return this.apiService.post("admin/users/"+user._id+"/reset-pwd")},AdminService.prototype.inactivateUser=function(user){return this.apiService.post("admin/users/"+user._id+"/inactivate")},AdminService.prototype.activateUser=function(user){return this.apiService.post("admin/users/"+user._id+"/activate")},AdminService.$inject=["appCommon","authService","apiService"],AdminService}(GrafikaApp.BaseService);GrafikaApp.AdminService=AdminService}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var MainController=function(_super){function MainController(appCommon,authService,animationService,$rootScope){var _this=this;_super.call(this,appCommon,authService),this.animationService=animationService,this.$rootScope=$rootScope;var query=appCommon.$location.search();query&&query.action&&(("verify"==query.action||"reset-pwd"==query.action)&&query.hash&&query.user?(appCommon.$mdDialog.show({controller:"ResetController",controllerAs:"vm",templateUrl:"app/account/reset.html",parent:angular.element(document.body),locals:{hash:query.hash,email:query.user}}).then(function(){return appCommon.navigate("/login")}),this.cleanUrlQueries()):"authenticate"==query.action?(this.authService.authenticate().then(function(){return _this.appCommon.navigateHome()}),this.cleanUrlQueries()):(appCommon.alert("Unknown action or link has expired"),this.cleanUrlQueries()))}return __extends(MainController,_super),MainController.prototype.close=function(){this.appCommon.$mdDialog.hide()},MainController.prototype.login=function(evt){this.appCommon.showDialog("LoginController","app/account/login-dialog.html",evt,"vm")},MainController.prototype.register=function(evt){this.appCommon.showDialog("RegisterController","app/account/register.html",evt,"vm")},MainController.prototype.confirmLogout=function(){var _this=this;this.appCommon.confirm("Are you sure you want to log out?").then(function(){return _this.appCommon.showLoadingModal(),_this.authService.logout()}).then(function(){_this.appCommon.toast("Successfully logged out"),_this.appCommon.hideLoadingModal()})},MainController.prototype.initGrafika=function(){if(!this.isAuthorized("user")){var bannerGrafika=this.appCommon.$window.bannerGrafika;bannerGrafika||(bannerGrafika=new Grafika),bannerGrafika.initialize("#banner-canvas",{drawingMode:"none",useNavigationText:!1,useCarbonCopy:!1,loop:!0}),bannerGrafika.demo.initialize("alphabet"),bannerGrafika.getAnimation().timer=500,bannerGrafika.play(),this.$rootScope.$on("$stateChangeStart",function(e){bannerGrafika.pause()})}},MainController.prototype.getAppVersion=function(){return this.appCommon.appConfig.appVersion},MainController.prototype.navigate=function(path){this.appCommon.navigate(path)},MainController.prototype.cleanUrlQueries=function(){var keys=this.appCommon.$location.search(),loc=this.appCommon.$location;Object.keys(keys).forEach(function(key){delete loc.search(key,null)}),this.appCommon.$location.hash(null)},MainController.$inject=["appCommon","authService","animationService","$rootScope"],MainController}(GrafikaApp.AuthController);GrafikaApp.MainController=MainController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var AdminController=function(_super){function AdminController(appCommon,authService,animationService,adminService){_super.call(this,appCommon,authService),this.animationService=animationService,this.adminService=adminService,this.serverConfigs=[],this.clientConfigs=[],this.configQuery="",this.userQuery="",this.animPaging=new GrafikaApp.QueryablePaging,this.animations=[],this.hasMoreAnims=!0,this.userPaging=new GrafikaApp.QueryablePaging,this.users=[],this.busy=!1}return __extends(AdminController,_super),AdminController.prototype.fetchServerInfo=function(){var _this=this;this.serverConfigs=[],this.clientConfigs=[],this.adminService.getServerInfo().then(function(result){_this.pushObject(_this.serverConfigs,null,result.data),_this.pushObject(_this.clientConfigs,null,_this.appCommon.appConfig)})},AdminController.prototype.fetchAnimations=function(append){var _this=this;append||(this.animPaging.skip=0),this.busy=!0,this.adminService.listAnimations(this.animPaging).then(function(result){return _this.animationService.injectThumbnailUrl(result)}).then(function(res){var anims=res.data;append?_this.animations=_this.animations.concat(anims):_this.animations=anims,_this.busy=!1,_this.hasMoreAnims=anims.length>=_this.animPaging.limit,_this.hasMoreAnims&&(_this.animPaging=_this.animPaging.next())})},AdminController.prototype.fetchUsers=function(){var _this=this;this.adminService.listUsers(this.userPaging).then(function(result){_this.users=result.data})},AdminController.prototype.canEdit=function(){return!0},AdminController.prototype.canDelete=function(){return!0},AdminController.prototype.confirmUserVerification=function(user){var _this=this;this.appCommon.confirm("Send verification email to "+user.email+"?").then(function(){return _this.adminService.sendVerificationEmail(user)}).then(function(){return _this.appCommon.toast("Verification email sent to "+user.email)})},AdminController.prototype.confirmUserPasswordReset=function(user){var _this=this;this.appCommon.confirm("Send reset password email to "+user.email+"?").then(function(){return _this.adminService.sendResetPasswordEmail(user)}).then(function(){return _this.appCommon.toast("Reset password email sent to "+user.email)})},AdminController.prototype.confirmDeactivate=function(user){var _this=this;this.appCommon.confirm("Inactivate "+user.email+"?").then(function(){return _this.adminService.inactivateUser(user)}).then(function(){return _this.fetchUsers(),_this.appCommon.toast("User is inactivated"),_this.appCommon.$q.when(!0)})},AdminController.prototype.confirmActivate=function(user){var _this=this;this.appCommon.confirm("Activate "+user.email+"?").then(function(){return _this.adminService.activateUser(user)}).then(function(){return _this.fetchUsers(),_this.appCommon.toast("User is activated"),_this.appCommon.$q.when(!0)})},AdminController.prototype.pushObject=function(configs,parentName,obj){var _this=this;Object.keys(obj).forEach(function(key){var value=obj[key];angular.isArray(value)?configs.push({key:parentName?parentName+"."+key:key,value:JSON.stringify(value,null," ")}):angular.isObject(value)?_this.pushObject(configs,parentName?parentName+"."+key:key,value):configs.push({key:parentName?parentName+"."+key:key,value:value})})},AdminController.$inject=["appCommon","authService","animationService","adminService"],AdminController}(GrafikaApp.AuthController);GrafikaApp.AdminController=AdminController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var LoginController=function(_super){function LoginController(appCommon,authService){_super.call(this,appCommon,authService)}return __extends(LoginController,_super),LoginController.prototype.register=function(){return this.appCommon.showDialog("RegisterController","app/account/register.html")},LoginController.prototype.login=function(provider){var _this=this,loginProvider=provider;this.appCommon.showLoadingModal().then(function(){return _this.authService.login({username:_this.username,password:_this.password},provider)}).then(function(res){loginProvider?_this.appCommon.toast("Connecting to "+loginProvider):_this.appCommon.navigateHome()})["catch"](function(res){return _this.appCommon.toastError(res),_this.appCommon.$q.when(!0)})["finally"](function(){_this.appCommon.hideLoadingModal(),_this.reset()})},LoginController.prototype.forgetPassword=function(evt){this.appCommon.showDialog("ForgetController","app/account/forget.html",evt,"vm")},LoginController.prototype.reset=function(){this.username="",this.password="",this.close()},LoginController.prototype.close=function(){this.appCommon.$mdDialog.hide()},LoginController.$inject=["appCommon","authService"],LoginController}(GrafikaApp.AuthController);GrafikaApp.LoginController=LoginController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var RegisterController=function(_super){function RegisterController(appCommon,authService){_super.call(this,appCommon),this.authService=authService,this.message="After signing up, you will receive email to activate your account.",this.name="",this.email="",this.busy=!1,this.done=!1}return __extends(RegisterController,_super),RegisterController.prototype.register=function(){var _this=this;this.message="Sending verification email...",this.busy=!0,this.authService.register({name:this.name,username:this.email,password:"fake-password"}).then(function(res){200==res.status?_this.message="Email has been sent":_this.handleError(res),_this.busy=!1,_this.done=!0})["catch"](function(error){return _this.handleError(error)})},RegisterController.prototype.handleError=function(err){this.message=this.appCommon.formatErrorMessage(err),this.busy=!1},RegisterController.$inject=["appCommon","authService"],RegisterController}(GrafikaApp.DialogController);GrafikaApp.RegisterController=RegisterController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var ForgetController=function(_super){function ForgetController(appCommon,authService){_super.call(this,appCommon),this.authService=authService,this.busy=!1}return __extends(ForgetController,_super),ForgetController.prototype.sendForgetEmail=function(){var _this=this;this.busy=!0,this.authService.resetPassword({email:this.email}).then(function(res){_this.appCommon.toast("Email sent"),_this.close()})["catch"](function(res){_this.message=_this.appCommon.formatErrorMessage(res)})["finally"](function(){_this.busy=!1})},ForgetController.$inject=["appCommon","authService"],ForgetController}(GrafikaApp.DialogController);GrafikaApp.ForgetController=ForgetController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var ResetController=function(_super){function ResetController(appCommon,authService,hash,email){_super.call(this,appCommon),this.authService=authService,this.hash=hash,this.email=email,this.busy=!1,this.done=!1,this.title="Set Password",this.subtitle="Hi "+email+", please set your password"}return __extends(ResetController,_super),ResetController.prototype.changePassword=function(){var _this=this;this.busy=!0;var user={hash:this.hash,username:this.email,password:this.newPassword};this.authService.register(user).then(function(res){_this.appCommon.toast("Password is sucessfully set, please re-login"),_this.close()})["catch"](function(res){_this.message=_this.appCommon.formatErrorMessage(res),_this.closable=!0})["finally"](function(){_this.busy=!1,_this.done=!0})},ResetController.$inject=["appCommon","authService","hash","email"],ResetController}(GrafikaApp.DialogController);GrafikaApp.ResetController=ResetController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var ProfileController=function(_super){function ProfileController(appCommon,authService,userService){var _this=this;_super.call(this,appCommon),this.authService=authService,this.userService=userService,this.userService.get(this.authService.getUser()._id).then(function(res){_this.user=res.data})}return __extends(ProfileController,_super),ProfileController.prototype.changePassword=function(event){this.appCommon.showDialog("PasswordController","app/account/reset.html",event)},ProfileController.prototype.checkUsernameAvailability=function(){var _this=this;this.userService.checkAvailability(this.user.email,this.user.username).then(function(){return _this.appCommon.toast(_this.user.username+" is available")})["catch"](function(err){return _this.appCommon.toastError(err)})},ProfileController.prototype.save=function(){var _this=this;this.userService.update(this.user).then(function(){return _this.needsUpdate=!1,_this.appCommon.toast("Saved!"),_this.authService.authenticate()})["catch"](function(err){return _this.appCommon.toastError(err)})},ProfileController.prototype.uploadAvatar=function($imageData){({name:$imageData.name,size:$imageData.size,mime:$imageData.mime});return this.appCommon.$q.when(!0)},ProfileController.$inject=["appCommon","authService","userService"],ProfileController}(GrafikaApp.DialogController);GrafikaApp.ProfileController=ProfileController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var SettingsController=function(_super){function SettingsController(appCommon,authService,userService){var _this=this;_super.call(this,appCommon),this.authService=authService,this.userService=userService,this.userService.get(this.authService.getUser()._id).then(function(res){_this.user=res.data})}return __extends(SettingsController,_super),SettingsController.prototype.save=function(){var _this=this;this.userService.update(this.user).then(function(){return _this.needsUpdate=!1,_this.appCommon.toast("Saved!"),_this.authService.authenticate()})["catch"](function(err){return _this.appCommon.toastError(err)})},SettingsController.$inject=["appCommon","authService","userService"],SettingsController}(GrafikaApp.DialogController);GrafikaApp.SettingsController=SettingsController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var PasswordController=function(_super){function PasswordController(appCommon,authService){_super.call(this,appCommon),this.authService=authService,this.requireCurrentPassword=!0,this.busy=!1,this.done=!1,this.title="Set Password",this.closable=!0}return __extends(PasswordController,_super),PasswordController.prototype.changePassword=function(){var _this=this;this.busy=!0;var pwd={currPwd:this.currentPassword,newPwd:this.newPassword};this.authService.changePassword(pwd).then(function(res){_this.appCommon.toast("Password is sucessfully changed"),_this.close()})["catch"](function(res){_this.message=_this.appCommon.formatErrorMessage(res)})["finally"](function(){_this.busy=!1,_this.closable=!0})},PasswordController.$inject=["appCommon","authService"],PasswordController}(GrafikaApp.DialogController);GrafikaApp.PasswordController=PasswordController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var BaseAnimationController=function(_super){function BaseAnimationController(appCommon,authService,animationService,frameService,resourceService){_super.call(this,appCommon,authService),this.animationService=animationService,this.frameService=frameService,this.resourceService=resourceService,this.load()}return __extends(BaseAnimationController,_super),BaseAnimationController.prototype.load=function(){var _this=this;this.animationService.get(this.appCommon.$stateParams._id).then(function(res){_this.animation=res.data,_this.onLoaded(_this.animation)})["catch"](function(err){return _this.onError(err)})},BaseAnimationController.prototype.onError=function(error){this.appCommon.$log.error(this.appCommon.formatErrorMessage(error))},BaseAnimationController.$inject=["appCommon","authService","animationService","frameService","resourceService"],BaseAnimationController}(GrafikaApp.AuthController);GrafikaApp.BaseAnimationController=BaseAnimationController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var AnimationListController=function(_super){function AnimationListController(appCommon,animationService,authService){_super.call(this,appCommon),this.animationService=animationService,this.authService=authService,this.hasMore=!0,this.busy=!1,this.paging=this.createPaging(),this.list()}return __extends(AnimationListController,_super),AnimationListController.prototype.list=function(append){var _this=this;append||(this.paging.skip=0),this.busy=!0,this.animationService.list(this.paging).then(function(res){append?_this.animations=_this.animations.concat(res.data):_this.animations=res.data,_this.busy=!1,_this.hasMore=res.data.length>=_this.paging.limit,_this.hasMore&&(_this.paging=_this.paging.next())})},AnimationListController.prototype.canEdit=function(){return!1},AnimationListController.prototype.canDelete=function(){return!1},AnimationListController.prototype.createPaging=function(){return new GrafikaApp.Paging({isPublic:!0,limit:this.appCommon.appConfig.fetchSize,skip:0})},AnimationListController.$inject=["appCommon","animationService","authService"],AnimationListController}(GrafikaApp.BaseController);GrafikaApp.AnimationListController=AnimationListController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var AnimationDetailController=function(_super){function AnimationDetailController(appCommon,authService,uxService,animationService,frameService,resourceService){_super.call(this,appCommon,authService,animationService,frameService,resourceService),this.uxService=uxService,this.disqusReady=!1,this.canEdit=!1}return __extends(AnimationDetailController,_super),AnimationDetailController.prototype.onLoaded=function(animation){var _this=this;if(this.uxService.pageTitle=this.animation.name,this.disqusConfig=new GrafikaApp.DisqusConfig(this.appCommon,animation._id),this.disqusConfig.disqus_title=animation.name,this.disqusConfig.disqus_url=this.appCommon.$location.absUrl(),this.authService.isAuthorized("user")){var user=this.authService.getUser();this.canEdit=user._id===this.animation.userId||user.roles.indexOf("administrator")>0,this.authService.getDisqusToken().then(function(res){_this.authService.isAuthenticated()&&(_this.disqusConfig.disqus_remote_auth_s3=res.data.token,_this.disqusReady=!0)})}else this.disqusReady=!0},AnimationDetailController.prototype.onError=function(err){var _this=this;this.appCommon.alert("An error has occured").then(function(){return _this.appCommon.navigateHome()})},AnimationDetailController.prototype.edit=function(){this.appCommon.$state.go("drawing",{_id:this.animation._id})},AnimationDetailController.prototype.editData=function(ev){var _this=this;this.appCommon.showDialog("AnimationEditController","/app/animation/edit.html",ev).then(function(){return _this.load()})},AnimationDetailController.prototype["delete"]=function(){var _this=this;return this.appCommon.confirm("Delete?").then(function(){return _this.animationService["delete"](_this.animation._id).then(function(){return _this.appCommon.navigateHome(),_this.appCommon.toast("Deleted")})})},AnimationDetailController.$inject=["appCommon","authService","uxService","animationService","frameService","resourceService"],AnimationDetailController}(GrafikaApp.BaseAnimationController);GrafikaApp.AnimationDetailController=AnimationDetailController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var AnimationEditController=function(_super){function AnimationEditController(appCommon,animationService){_super.call(this,appCommon),this.animationService=animationService,this.load()}return __extends(AnimationEditController,_super),AnimationEditController.prototype.load=function(){var _this=this;this.animationService.get(this.appCommon.$stateParams._id).then(function(res){_this.animation=res.data})},AnimationEditController.prototype.save=function(){var _this=this;this.animation.dateModified=Date.now(),this.animationService.update(this.animation).then(function(res){_this.close().then(function(){return _this.appCommon.toast("Saved")})})},AnimationEditController.$inject=["appCommon","animationService"],AnimationEditController}(GrafikaApp.DialogController);GrafikaApp.AnimationEditController=AnimationEditController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var AnimationDrawingController=function(_super){function AnimationDrawingController(appCommon,authService,uxService,animationService,frameService,resourceService){_super.call(this,appCommon,authService,animationService,frameService,resourceService),this.uxService=uxService,this.animationService=animationService,this.frameService=frameService,this.resourceService=resourceService,this.grafika=new Grafika,this.appCommon.hideLoadingModal()}return __extends(AnimationDrawingController,_super),AnimationDrawingController.prototype.onLoaded=function(animation){var _this=this;this.uxService.pageTitle="Edit "+this.animation.name,this.appCommon.elem("#canvas-container").css("width",this.animation.width).css("height",this.animation.height),this.frameService.get(this.animation).then(function(res){_this.animation.frames=res.data,_this.grafika.initialize("#canvas",{drawingMode:"paint"},_this.animation)})},AnimationDrawingController.prototype.showProperties=function(ev){var _this=this;return this.appCommon.showDialog("AnimationEditController","/app/animation/edit.html",ev).then(function(){return _this.load()})},AnimationDrawingController.prototype.save=function(exit){var _this=this;this.grafika.save();var animation=this.grafika.getAnimation();this.animationService.update(animation).then(function(res){return _this.resourceService.saveThumbnail(animation)}).then(function(res){return _this.resourceService.upload(res.data,_this.grafika.exts.getCanvasBlob())}).then(function(res){exit&&_this.exit(),_this.appCommon.toast("Successfully saved!")})},AnimationDrawingController.prototype.confirmExit=function(){var _this=this,anim=this.animation;anim.modified?this.appCommon.confirm("Close?").then(function(){return _this.exit()}):this.exit()},AnimationDrawingController.prototype.exit=function(){this.appCommon.$state.go("my-animations")},AnimationDrawingController.$inject=["appCommon","authService","uxService","animationService","frameService","resourceService"],AnimationDrawingController}(GrafikaApp.BaseAnimationController);GrafikaApp.AnimationDrawingController=AnimationDrawingController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var AnimationCreateController=function(_super){function AnimationCreateController(appCommon,authService,animationService){_super.call(this,appCommon),this.authService=authService,this.animationService=animationService,this.width=800,this.height=400,this.orientations=["Landscape","Portrait"],this.orientation="Landscape",this.isPublic=this.authService.getUser().prefs.drawingIsPublic}return __extends(AnimationCreateController,_super),AnimationCreateController.prototype.create=function(){var _this=this,anim=new GrafikaApp.Animation;anim.name=this.name,anim.isPublic=this.isPublic,"Landscape"===this.orientation?(anim.width=this.width,anim.height=this.height):(anim.width=this.height,anim.height=this.width),this.animationService.create(anim).then(function(res){_this.close(),_this.appCommon.showLoadingModal().then(function(){var anim=res.data;_this.appCommon.$state.go("drawing",{_id:anim._id})})})},AnimationCreateController.$inject=["appCommon","authService","animationService"],AnimationCreateController}(GrafikaApp.DialogController);GrafikaApp.AnimationCreateController=AnimationCreateController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var MyAnimationsController=function(_super){function MyAnimationsController(appCommon,animationService,authService){_super.call(this,appCommon,animationService,authService)}return __extends(MyAnimationsController,_super),MyAnimationsController.prototype.create=function(ev){var _this=this;return this.appCommon.showDialog("AnimationCreateController","/app/animation/create.html",ev).then(function(answer){return _this.appCommon.toast("Animation is created")})},MyAnimationsController.prototype.canEdit=function(){
return!0},MyAnimationsController.prototype.canDelete=function(){return!0},MyAnimationsController.prototype.confirmDelete=function(anim){var _this=this;this.appCommon.confirm("Delete?",anim.name).then(function(result){result&&_this.animationService["delete"](anim._id).then(function(result){_this.list(),_this.appCommon.toast(anim.name+" deleted")})})},MyAnimationsController.prototype.createPaging=function(){return new GrafikaApp.Paging({userId:this.authService.getUser()._id,limit:this.appCommon.appConfig.fetchSize,skip:0})},MyAnimationsController.$inject=["appCommon","animationService","authService"],MyAnimationsController}(GrafikaApp.AnimationListController);GrafikaApp.MyAnimationsController=MyAnimationsController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var AnimationPlaybackController=function(_super){function AnimationPlaybackController(appCommon,authService,animationService,frameService,resourceService,$scope){_super.call(this,appCommon,authService,animationService,frameService,resourceService),this.$scope=$scope,this.totalFrame=0,this.currentFrame=0,this.isPlaying=!1,this.animationName="loading..."}return __extends(AnimationPlaybackController,_super),AnimationPlaybackController.prototype.onLoaded=function(animation){var _this=this;this.animationName=this.animation.name,this.grafika||(this.grafika=new Grafika),this.grafika.initialize("#canvas",this.getOptions(),this.animation),this.grafika.setCallback({on:function(ev,obj){switch(ev){case"frameChanged":_this.currentFrame=parseInt(obj),_this.$scope.$applyAsync("vm.currentFrame");break;case"playing":_this.isPlaying=obj,_this.$scope.$applyAsync("vm.isPlaying")}}}),this.frameService.get(animation).then(function(res){_this.grafika.setFrames(res.data),_this.totalFrame=res.data.length,_this.currentFrame=0,_this.animationService.incrementViewCount(animation)})},AnimationPlaybackController.prototype.toggle=function(){this.grafika.isPlaying()?this.grafika.pause():this.grafika.play()},AnimationPlaybackController.prototype.previousFrame=function(){this.grafika.previousFrame()},AnimationPlaybackController.prototype.nextFrame=function(){this.grafika.nextFrame()},AnimationPlaybackController.prototype.getOptions=function(){var opts={useNavigationText:!1,useCarbonCopy:!1},user=this.authService.getUser();return user&&(opts.loop=user.prefs.playbackLoop),opts},AnimationPlaybackController.$inject=["appCommon","authService","animationService","frameService","resourceService","$scope"],AnimationPlaybackController}(GrafikaApp.BaseAnimationController);GrafikaApp.AnimationPlaybackController=AnimationPlaybackController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var UserController=function(_super){function UserController(appCommon,animationService,userService){_super.call(this,appCommon),this.animationService=animationService,this.userService=userService,this.list()}return __extends(UserController,_super),UserController.prototype.list=function(){var _this=this;this.userService.get(this.appCommon.$stateParams._id).then(function(res){_this.user=new GrafikaApp.User(res.data),_this.loadAnimations()})},UserController.prototype.loadAnimations=function(){var _this=this;this.paging=new GrafikaApp.Paging({userId:this.user._id,isPublic:!0}),this.animationService.list(this.paging).then(function(res){_this.animations=res.data})},UserController.$inject=["appCommon","animationService","userService"],UserController}(GrafikaApp.BaseController);GrafikaApp.UserController=UserController}(GrafikaApp||(GrafikaApp={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},GrafikaApp;!function(GrafikaApp){var ContentController=function(_super){function ContentController(appCommon){_super.call(this,appCommon)}return __extends(ContentController,_super),ContentController}(GrafikaApp.BaseController);GrafikaApp.ContentController=ContentController}(GrafikaApp||(GrafikaApp={}));var GrafikaApp;!function(GrafikaApp){var app=angular.module("app",["ui.router","ngMaterial","ngCookies","ngMessages","ngSanitize","angular-jwt","angularSpectrumColorpicker","angularUtils.directives.dirDisqus"]);app.constant("appConfig",new GrafikaApp.AppConfig),app.service("appCommon",GrafikaApp.AppCommon),app.factory("authInterceptor",GrafikaApp.AuthInterceptor),app.config(GrafikaApp.Routes),app.config(GrafikaApp.HttpInterceptor),app.config(GrafikaApp.Theme),app.filter("keyboardShortcut",GrafikaApp.KeyboardFilter),app.directive("activeLink",GrafikaApp.ActiveLinkDirective.factory()),app.directive("imageUploader",GrafikaApp.ImageUploaderDirective.factory()),app.directive("noResult",GrafikaApp.NoResultDirective.factory()),app.directive("fetchMore",GrafikaApp.FetchMoreDirective.factory()),app.directive("ratingStars",GrafikaApp.RatingStarsDirective.factory()),app.directive("includeMarkdown",GrafikaApp.IncludeMarkdownDirective.factory()),app.directive("gfSpinner",GrafikaApp.GfSpinner.factory()),app.service("uxService",GrafikaApp.UxService),app.service("apiService",GrafikaApp.ApiService),app.service("authService",GrafikaApp.AuthService),app.service("animationService",GrafikaApp.AnimationService),app.service("frameService",GrafikaApp.FrameService),app.service("resourceService",GrafikaApp.ResourceService),app.service("userService",GrafikaApp.UserService),app.service("adminService",GrafikaApp.AdminService),app.controller("AppController",GrafikaApp.AppController),app.controller("MainController",GrafikaApp.MainController),app.controller("ForgetController",GrafikaApp.ForgetController),app.controller("LoginController",GrafikaApp.LoginController),app.controller("RegisterController",GrafikaApp.RegisterController),app.controller("ResetController",GrafikaApp.ResetController),app.controller("ProfileController",GrafikaApp.ProfileController),app.controller("SettingsController",GrafikaApp.SettingsController),app.controller("PasswordController",GrafikaApp.PasswordController),app.controller("AdminController",GrafikaApp.AdminController),app.controller("AnimationCreateController",GrafikaApp.AnimationCreateController),app.controller("AnimationDetailController",GrafikaApp.AnimationDetailController),app.controller("AnimationEditController",GrafikaApp.AnimationEditController),app.controller("AnimationDrawingController",GrafikaApp.AnimationDrawingController),app.controller("AnimationListController",GrafikaApp.AnimationListController),app.controller("AnimationPlaybackController",GrafikaApp.AnimationPlaybackController),app.controller("MyAnimationsController",GrafikaApp.MyAnimationsController),app.controller("UserController",GrafikaApp.UserController)}(GrafikaApp||(GrafikaApp={}));
//# sourceMappingURL=grafika.app.js.map